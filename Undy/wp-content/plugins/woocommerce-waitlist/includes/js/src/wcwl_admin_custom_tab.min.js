jQuery(document).ready(function(l){function e(t){return 0<l(t).find("tr.wcwl_user_row").length}function a(t){e(t)?function(t){l(t).find(".wcwl_waitlist_table").show(),l(t).find(".wcwl_no_users_text ").hide(),l(t).find("button.wcwl_email_add_user").is(":visible")||l(t).find(".wcwl_actions").show(),"archive"==l(t).data("panel")&&l(t).find(".wcwl_add_user_wrap ").show()}(t):function(t){l(t).find(".wcwl_actions").hide(),l(t).find(".wcwl_waitlist_table").hide(),l(t).find(".wcwl_no_users_text ").show(),"archive"==l(t).data("panel")&&l(t).find(".wcwl_add_user_wrap").hide()}(t),i()}function n(t){var i=l(t).closest(".wcwl_tab_content");i.find(".wcwl_add_user_content").hide(),i.find(".wcwl_add").show(),i.find(".wcwl_email").val(""),e(i)?(i.find(".wcwl_actions").show(),i.find(".wcwl_no_users").hide()):i.find(".wcwl_no_users").show()}function w(t,c,i,a){var e={action:"wcwl_add_user_to_waitlist",emails:t,product_id:c,wcwl_add_user_nonce:i};l.post(ajaxurl,e,function(t){l(".wcwl_notice").remove();var i=l.parseJSON(t),e=l('.wcwl_body_wrap[data-product-id="'+c+'"] .'+a+" .wcwl_waitlist_table");o(i.users,c,e,a),l("#wcwl_variation_"+c).length&&s(c),r(i.type,i.message,c,a),v(a=l('.wcwl_body_wrap[data-product-id="'+c+'"]').find("."+a),".wcwl_email_add_user"),n(a.find(".wcwl_waitlist_table"))})}function o(t,c,a,n){l.each(t,function(t,i){if(0==a.find('input[data-user-email="'+i.email+'"]').length&&0!==i.id){!function(t,i,e,c){var a=t.join_date;"archive"==c&&(a=t.date);var n='<tr class="wcwl_user_row" data-user-id="'+t.id+'">';n+='<td><input class="wcwl_user_checkbox" type="checkbox" name="wcwl_user_checkbox" value="'+t.id+'" data-user-email="'+t.email+'" data-date-added="'+a+'"/></td>',n+='<td><strong><a title="'+wcwl_tab.view_profile_text+'" href="'+t.link+'">'+t.email+"</a></strong></td>",n+="<td>"+t.join_date+"</td></tr>",e.append(n)}(i,0,a,n);var e=l("#wcwl_variation_"+c);0<e.length&&(s(c),e.removeClass("wcwl_hidden"))}})}function s(t){var i=l("#wcwl_variation_"+t+" .wcwl_count"),e=l('.wcwl_body_wrap[data-product-id="'+t+'"] .waitlist tr.wcwl_user_row').length;i.text(parseInt(e))}function _(t){var i="";return l(t).each(function(){i+=l(this).data("user-email")+","}),i}function d(t,e,c,a){l.each(t,function(t,i){a.find('tr[data-user-id="'+i.id+'"]').first().remove(),"waitlist"==c&&l("#wcwl_variation_"+e).length&&s(e)}),0==a.find("tr.wcwl_user_row").length&&(a.hide(),a.closest(".wcwl_tab_content").find(".wcwl_no_users").show(),"archive"==c&&l('.wcwl_body_wrap[data-product-id="'+e+'"] .'+c+" .wcwl_add_user_wrap").hide())}function r(t,i,e,c){l(".wcwl_notice").remove();var a=u(t,i);"options"==c?l(a).insertBefore(l('.wcwl_body_wrap[data-product-id="'+e+'"] .options')):l(a).insertAfter(l('.wcwl_body_wrap[data-product-id="'+e+'"] .'+c+" .wcwl_actions")),"success"==t&&l(".wcwl_notice").delay(3e3).slideToggle(),p()}function u(t,i){var e='<div class="wcwl_notice wcwl_notice_'+t+'">';return e+="<p>"+i+"</p>",e+='<span class="wcwl_dismiss dashicons dashicons-dismiss"></span></div>'}function p(){l(".wcwl_notice").on("click",".wcwl_dismiss",function(){l(this).closest(".wcwl_notice").remove(),l("ul.waitlist-tabs").css("margin-top","0")})}if(l(".wcwl_variation_tab").on("click",".wcwl_header_wrap",function(){l(this).next(l(".wcwl_body_wrap")).slideToggle()}),l("ul.wcwl_tabs").on("click","li",function(){l(".wcwl_notice").remove();var t=l(this).closest(".wcwl_body_wrap");l(t).find("ul.wcwl_tabs li, .wcwl_tab_content").removeClass("current");var i=l(this).data("tab");l(this).addClass("current"),l(t).find(".wcwl_tab_content."+i).addClass("current")}),l(".wcwl_tab_content").each(function(){a(this),i()}),l(".wcwl_add_user_wrap").on("click",".wcwl_add",function(){var t=l(this).closest(".wcwl_tab_content");l(".wcwl_notice").remove(),l(this).hide(),t.find(".wcwl_no_users").hide(),t.find(".wcwl_add_user_content").show(),t.find(".wcwl_actions").hide()}),l(".wcwl_add_user_wrap").on("click",".wcwl_back",function(t){l(".wcwl_notice").remove(),n(this)}),l(".wcwl_add_user_wrap").on("click",".wcwl_email_add_user",function(){var t=l(this).closest(".wcwl_tab_content").find("input.wcwl_email").val().split(","),e=k(this),i=l(this).data("nonce"),c=l('.wcwl_email_add_user[data-product-id="'+e+'"]'),a=l(this).closest(".wcwl_tab_content").data("panel"),n=!1;if(b(c),l.isArray(t))l.each(t,function(t,i){if(!f(i=i.replace(/ /g,"")))return r("error",wcwl_tab.invalid_email,e,a),n=!0,m(a,"add_user",wcwl_tab.add_text),!1}),n||w(t,e,i,a);else{if(!f(t))return r("error",wcwl_tab.invalid_email,e,a),n=!0,m(a,"add_user",wcwl_tab.add_text),!1;w(t,e,i,a)}}),l(".wcwl_waitlist_table").on("click",'input[name="wcwl_select_all"]',function(){var t=l(this).closest("tbody").find(".wcwl_user_checkbox"),i=l(this).prop("checked");l(t).each(function(){l(this).prop("checked",i)})}),l(".wcwl_actions").on("click","button.wcwl_action",function(){var t=l(this).prev("select.wcwl_action").val(),i=l(this).closest(".wcwl_tab_content").data("panel"),e=k(this);if(t){var c=l('.wcwl_body_wrap[data-product-id="'+e+'"] .'+i+" .wcwl_user_checkbox:checkbox:checked"),a="";if("wcwl_email_custom"==t)0<(a=_(c)).length?window.location="mailto:"+wcwl_tab.admin_email+"?bcc="+a:r("error",wcwl_tab.no_users_text,e,i);else if("wcwl_export"==t)0<(a=_(c)).length?(b(this),function(t,i,e){var c=e+"-export-"+i+".csv",a=encodeURI("data:text/csv;charset=utf-8,"+t),n=l('.wcwl_body_wrap[data-product-id="'+i+'"] .'+e),w=document.createElement("a");w.setAttribute("href",a),w.setAttribute("download",c),w.click(),m(n,"action",wcwl_tab.go_text)}(a,e,i)):r("error",wcwl_tab.no_users_text,e,i);else{var n=function(t){var i=[];return l(t).each(function(){var t={date:l(this).data("date-added"),id:l(this).val()};i.push(t)}),i}(c),w=l(this).data("nonce");b(this),function(c,a,t,i,n){var e={action:c,product_id:a,users:t,wcwl_action_nonce:i};l.post(ajaxurl,e,function(t){l(".wcwl_notice").remove();var i=l.parseJSON(t),e="";if("success"==i.type)if("wcwl_remove_waitlist"==c)e=l('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist .wcwl_waitlist_table'),d(i.users,a,n,e),e.find("input").prop("checked",!1),"yes"==i.archive&&(e=l('.wcwl_body_wrap[data-product-id="'+a+'"] .archive .wcwl_waitlist_table'),o(i.users,a,e,"archive"),archive_panel=l('.wcwl_body_wrap[data-product-id="'+a+'"]').find(".archive"),v(archive_panel,".wcwl_action"));else if("wcwl_remove_archive"==c)e=l('.wcwl_body_wrap[data-product-id="'+a+'"] .archive .wcwl_waitlist_table'),d(i.users,a,n,e),e.find("input").prop("checked",!1);else if("wcwl_return_to_waitlist"==c){e=l('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist .wcwl_waitlist_table'),o(i.users,a,e,"waitlist"),v(l('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist'),".wcwl_action")}r(i.type,i.message,a,n),v(l('.wcwl_body_wrap[data-product-id="'+a+'"]').find("."+n),".wcwl_action")})}(t,e,n,w,i)}}else r("error",wcwl_tab.no_action_text,e,i)}),p(),0<l(".wcwl_header_wrap").length){var h=0;l(document).ajaxSuccess(function(t,i,e,c){"string"==typeof c&&c.substring(0,35).includes("woocommerce_variation")&&(l(".wcwl_notice").remove(),1<++h&&(l("#wcwl_waitlist_data").prepend(u("info",wcwl_tab.update_waitlist_notice)),p()))})}function f(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function b(t){l(t).text(""),l(t).append('<span class="wcwl_loading spinner is-active"></span>'),l(t).attr("disabled","disabled")}function m(t,i,e){var c="";c="add_user"==i?"button.wcwl_email_add_user":"update_options"==i?".options button":"button.wcwl_action",l(t).find(l(c)).text(e),l(c).removeAttr("disabled"),l(c).find("span.wcwl_loading").remove()}function v(t,i){var e=l(t).find("button"+i),c="";".wcwl_email_add_user"==i?(c=wcwl_tab.add_text,type="add_user"):(c=wcwl_tab.go_text,type="action"),m(t,type,c),l(e).prev(".wcwl_email").val(""),l(e).prev("select.wcwl_action").val("0"),a(t)}function k(t){return l(t).closest(".wcwl_body_wrap").data("product-id")}l(".options").on("change",'input[name="enable_stock_trigger"]',function(){l(this).is(":checked")?(l(this).closest(".options").find('input[name="minimum_stock"]').removeAttr("disabled"),l(this).closest(".options").find('label[for="minimum_stock"]').removeClass("wcwl_disabled")):(l(this).closest(".options").find('input[name="minimum_stock"]').attr("disabled","disabled"),l(this).closest(".options").find('label[for="minimum_stock"]').addClass("wcwl_disabled"))}),l(".options").on("click","button",function(){b(this);var t=l(this).closest(".wcwl_tab_content"),i=k(this),e=t.find('input[name="enable_stock_trigger"]').is(":checked"),c={enable_waitlist:t.find('input[name="enable_waitlist"]').is(":checked"),enable_stock_trigger:e},a=t.find('input[name="minimum_stock"]');c.minimum_stock=e?a.val():a.data("default-stock"),a.val(c.minimum_stock),function(e,c,t){var i=e.find("button"),a={action:"wcwl_update_waitlist_options",product_id:c,options:t,wcwl_update_nonce:i.data("nonce")};l.post(ajaxurl,a,function(t){l(".wcwl_notice").remove();var i=l.parseJSON(t);r(i.type,i.message,c,"options"),m(e,"update_options",wcwl_tab.update_button_text)})}(t,i,c)}),l("#wcwl_waitlist_data").on("keyup keypress",'input.wcwl_email, input[name="minimum_stock"]',function(t){13===(t.keyCode||t.which)&&(t.preventDefault(),"minimum_stock"==l(this).attr("name")?l(this).closest(".options").find("button").trigger("click"):l(this).next("button").trigger("click"))});var g=null,x=null;function i(){l(".waitlist .wcwl_user_checkbox").click(function(t){c(l(".waitlist .wcwl_user_checkbox"),this,g,"waitlist",t)}),l(".archive .wcwl_user_checkbox").click(function(t){c(l(".archive .wcwl_user_checkbox"),this,x,"archive",t)})}function c(t,i,e,c,a){if(e){if(a.shiftKey){var n=t.index(i),w=t.index(e);t.slice(Math.min(n,w),Math.max(n,w)+1).prop("checked",e.checked)}"waitlist"==c?g=i:x=i}else"waitlist"==c?g=i:x=i}});